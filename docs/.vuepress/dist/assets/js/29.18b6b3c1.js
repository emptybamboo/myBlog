(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{373:function(a,s,t){"use strict";t.r(s);var e=t(42),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[a._v("#")]),a._v(" 索引")]),a._v(" "),t("h3",{attrs:{id:"概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[a._v("#")]),a._v(" 概念")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("索引是表的目录，在查找内容之前可以先在目录中查找索引位置，以此快速定位查询数据。对于索引，会保存在额外的文件中。")])]),a._v(" "),t("li",[t("p",[a._v("索引，是数据库中专门用于帮助用户快速查询数据的一种数据结构。"),t("strong",[a._v("类似于字典中的目录")]),a._v("，查找字典内容时可以根据目录查找到数据的存放位置，然后直接获取即可。")]),a._v(" "),t("blockquote",[t("ol",[t("li",[a._v("越小的数据类型通常更好：越小的数据类型通常在磁盘、内存和CPU缓存中都需要更少的空间，处理起来更快。")]),a._v(" "),t("li",[a._v("简单的数据类型更好：整型数据比起字符，处理开销更小，因为字符串的比较更复杂。")]),a._v(" "),t("li",[a._v("尽量避免NULL：应该指定列为NOT nuLL,在MySQL中， "),t("strong",[a._v("含有空值的列很难进行查询优化")]),a._v("，因为它们使得索引、索引的统计信息以及比较运算更加复杂")])])])])]),a._v(" "),t("h4",{attrs:{id:"不适合创建索引的情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不适合创建索引的情况"}},[a._v("#")]),a._v(" 不适合创建索引的情况")]),a._v(" "),t("ol",[t("li",[a._v("对于那些在查询中很少使用或者参考的列不应该创建索引。")]),a._v(" "),t("li",[a._v("对于那 些只有很少数据值的列也不应该增加索引。因为本来结果集合就是相当于全表查询了，所以没有必要。")]),a._v(" "),t("li",[a._v("对于那些定义为text, image和bit数据类型的列不应该增加索引。这是因为，这些列的数据量要么相当大，要么取值很少。")]),a._v(" "),t("li",[a._v("当修改性能远远大于检索性能时，不应该创建索引。")]),a._v(" "),t("li",[a._v("不会出现在where条件中的字段不该建立索引")])]),a._v(" "),t("h4",{attrs:{id:"适合创建索引的情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#适合创建索引的情况"}},[a._v("#")]),a._v(" 适合创建索引的情况")]),a._v(" "),t("ol",[t("li",[a._v("表的主键、外键必须有索引；"),t("strong",[a._v("外键是唯一的，而且经常会用来查询")])]),a._v(" "),t("li",[a._v("数据量超过300的表应该有索引；")]),a._v(" "),t("li",[a._v("经常与其他表进行连接的表，在连接字段上应该建立索引；"),t("strong",[a._v("经常连接查询，需要有索引")])]),a._v(" "),t("li",[a._v("经常出现在Where子句中的字段，加快判断速度，特别是大表的字段，应该建立索引，建立索引，一般用在select ……where f1 and f2 ，我们在f1或者f2上建立索引是没用的。"),t("strong",[a._v("只有两个使用联合索引才能有用")])]),a._v(" "),t("li",[t("strong",[a._v("经常用到排序的列上")]),a._v("，因为索引已经排序。")]),a._v(" "),t("li",[t("strong",[a._v("经常用在范围内搜索的列上创建索引")]),a._v("，因为索引已经排序了，其指定的范围是连续的")])]),a._v(" "),t("h3",{attrs:{id:"索引优缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引优缺点"}},[a._v("#")]),a._v(" 索引优缺点")]),a._v(" "),t("h4",{attrs:{id:"优点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[a._v("#")]),a._v(" 优点")]),a._v(" "),t("ul",[t("li",[a._v("索引由数据库中一列或多列组合而成，其作用是提高对表中数据的查询速度")])]),a._v(" "),t("h4",{attrs:{id:"缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[a._v("#")]),a._v(" 缺点")]),a._v(" "),t("ul",[t("li",[a._v("索引的缺点是创建和维护索引需要耗费时间")]),a._v(" "),t("li",[a._v("可以提高查询速度，会减慢写入速度")]),a._v(" "),t("li",[a._v("索引并不是越多越好，索引固然可以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。"),t("strong",[a._v("一个表的索引数最好不要超过6个")]),a._v("，若太多则应考虑一些不常使用到的列上建的索引是否有必要。")])]),a._v(" "),t("h3",{attrs:{id:"索引分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引分类"}},[a._v("#")]),a._v(" 索引分类")]),a._v(" "),t("ol",[t("li",[t("strong",[a._v("普通索引")])])]),a._v(" "),t("blockquote",[t("p",[a._v("仅加速查询 最基本的索引，没有任何限制，是我们大多数情况下使用到的索引。")])]),a._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INDEX")]),a._v("  index_name  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" user_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("​\t注意: 对于创建索引时如果是blob 和 text 类型，必须指定length。")]),a._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("create")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("index")]),a._v(" ix_extra "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" in1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("alter")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("table")]),a._v(" employee "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("add")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("index")]),a._v(" emp_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("​\t删除索引")]),a._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("drop")]),a._v(" index_name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" healerjean"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("alter")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLE")]),a._v(" users  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("drop")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("index")]),a._v("  name_index "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("​\t查看索引")]),a._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("show")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("index")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("table")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[t("strong",[a._v("唯一索引")])])]),a._v(" "),t("blockquote",[t("p",[a._v("与普通索引类型，不同的是：加速查询 + 列值唯一（可以有null）")])]),a._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("UNIQUE")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INDEX")]),a._v("  mail  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" user_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[t("strong",[a._v("全文索引")])])]),a._v(" "),t("blockquote",[t("p",[a._v("全文索引（FULLTEXT）仅可以适用于MyISAM引擎的数据表；作用于CHAR、VARCHAR、TEXT数据类型的列。")])]),a._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[t("strong",[a._v("组合索引")])])]),a._v(" "),t("blockquote",[t("p",[a._v("将几个列作为一条索引进行检索，使用最左匹配原则。")])]),a._v(" "),t("h3",{attrs:{id:"正确使用索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#正确使用索引"}},[a._v("#")]),a._v(" 正确使用索引")]),a._v(" "),t("ul",[t("li",[a._v("在查询语句前加explain,看explain中出现的row有有多少行,行数越多,表示执行速度越慢")]),a._v(" "),t("li",[a._v("如果以错误的方式使用，则即使建立索引也会不奏效。")])]),a._v(" "),t("h4",{attrs:{id:"对于创建的多列索引-只要查询的条件中用到了最左边的列-索引一般就会被使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#对于创建的多列索引-只要查询的条件中用到了最左边的列-索引一般就会被使用"}},[a._v("#")]),a._v(" 对于创建的多列索引,只要查询的条件中用到了最左边的列,索引一般就会被使用")]),a._v(" "),t("ul",[t("li",[a._v("意思是假如现在有一个薪水表salary,里面有两个字段id和adid,这两个字段组成一个联合索引,在select查询语句中,即使where后面的等于条件只有一个id(居左的列),索引依然成立.但是如果where后只使用adid为条件,索引就不会被使用.")])]),a._v(" "),t("h4",{attrs:{id:"对于使用-like-的查询-后面如果是常量并且-号不在第一个字符-索引才可能会被使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#对于使用-like-的查询-后面如果是常量并且-号不在第一个字符-索引才可能会被使用"}},[a._v("#")]),a._v(" 对于使用 like 的查询,后面如果是常量并且%号不在第一个字符,索引才可能会被使用")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("explain select * from company2 where name like '%3'\\G;\n\nexplain select * from company2 where name like '3%'\\G;\n")])])]),t("ul",[t("li",[a._v("第一个例子没有使用索引,而第二例子就能够使用索引,")]),a._v(" "),t("li",[a._v("区别就在于“%”的位置不同,前者把“%”放到第一位就不能用到索引,而后者没有放到第一位就使用了索引。")])]),a._v(" "),t("h4",{attrs:{id:"如果列名-是索引-使用-column-name-is-null-将使用索引。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如果列名-是索引-使用-column-name-is-null-将使用索引。"}},[a._v("#")]),a._v(" 如果列名,是索引,使用 column_name is null 将使用索引。")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("列名就是字段名")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("explain select * from company2 where name is null\\G;\n")])])])])]),a._v(" "),t("h4",{attrs:{id:"如果对大的文本进行搜索-使用全文索引而不用使用-like"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如果对大的文本进行搜索-使用全文索引而不用使用-like"}},[a._v("#")]),a._v(" 如果对大的文本进行搜索,使用全文索引而不用使用 like ‘%…%’")]),a._v(" "),t("h3",{attrs:{id:"存在索引-但是不使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存在索引-但是不使用"}},[a._v("#")]),a._v(" 存在索引,但是不使用")]),a._v(" "),t("h4",{attrs:{id:"如果-mysql-估计使用索引比全表扫描更慢-则不使用索引。例如-如果列key-part1-均匀分布在-1-和-100-之间-下列查询中使用索引就不是很好"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如果-mysql-估计使用索引比全表扫描更慢-则不使用索引。例如-如果列key-part1-均匀分布在-1-和-100-之间-下列查询中使用索引就不是很好"}},[a._v("#")]),a._v(" 如果 MySQL 估计使用索引比全表扫描更慢,则不使用索引。例如，如果列key_part1 均匀分布在 1 和 100 之间,下列查询中使用索引就不是很好")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("SELECT * FROM table_name where key_part1 > 1 and key_part1 < 90;\n")])])]),t("h4",{attrs:{id:"用-or-分割开的条件-如果-or-前的条件中的列有索引-而后面的列中没有索引-那么涉及到的索引都不会被用到-例如-必须or前后都有索引才能被使用-而且必须是单独索引。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用-or-分割开的条件-如果-or-前的条件中的列有索引-而后面的列中没有索引-那么涉及到的索引都不会被用到-例如-必须or前后都有索引才能被使用-而且必须是单独索引。"}},[a._v("#")]),a._v(" 用 or 分割开的条件,如果 or 前的条件中的列有索引,而后面的列中没有索引,那么涉及到的索引都不会被用到,例如:必须or前后都有索引才能被使用，而且必须是单独索引。")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("explain select * from company2 where name = 294\\G;//使用索引\n\nexplain select * from company2 where name = '294'\\G;//不使用索引\n\n")])])]),t("h3",{attrs:{id:"联合索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#联合索引"}},[a._v("#")]),a._v(" 联合索引")]),a._v(" "),t("h4",{attrs:{id:"精确查找联合索引总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#精确查找联合索引总结"}},[a._v("#")]),a._v(" 精确查找联合索引总结")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("顾名思义是最左优先，以"),t("strong",[a._v("最左边的为起点")]),a._v("任何连续的索引都能匹配上")])]),a._v(" "),t("li",[t("p",[a._v("多个单列索引在多条件查询时只会生效第一个索引！所以多条件联合查询时最好建联合索引！")]),a._v(" "),t("p",[a._v("当创建**(a,b,c)联合索引时**，相当于创建了**(a)单列索引**，"),t("strong",[a._v("(a,b)联合索引")]),a._v("以及**(a,b,c)联合索引**\n想要索引生效的话,只能使用 a和a,b和a,b,c三种组合；当然，我们上面测试过，a,c组合也可以，但实际上只用到了a的索引，c并没有用到！")])]),a._v(" "),t("li",[t("p",[a._v("具体使用 a b c 的顺序无关，mysql会自动优化，但是我们建议按照索引的顺序进行查询，而且尽量将筛选力度大的放到前面，其实这种也不要一定是准确的，其实真正有影响的是是否用到了索引")])])]),a._v(" "),t("h3",{attrs:{id:"单列索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单列索引"}},[a._v("#")]),a._v(" 单列索引")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("查询条件为 name：使用到了索引 name（长度为512 = 4 * 128 + 2）")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("explain  SELECT * from d001_index WHERE name = 'zhangyj' ;\n\n")])])])]),a._v(" "),t("li",[t("p",[a._v("查询条件为 name 、 age ：只使用了第一个 name索引（长度为512 = 4 * 128 + 2）")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("explain  SELECT * from d001_index WHERE name = 'zhangyj' and age = 3 ;\n\n")])])])]),a._v(" "),t("li",[t("p",[a._v("查询条件为 name or age ：两个索引都用上了 type = INDEX_MERGE 合并索引")])])]),a._v(" "),t("blockquote",[t("p",[a._v("index merge 技术如果简单的说，其实就是："),t("strong",[a._v("对多个索引分别进行条件扫描，然后将它们各自的结果进行合并(intersect/union)")]),a._v("。")])]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("explain  SELECT * from d001_index WHERE name = 'zhangyj' or age = 3 ;\n\n")])])]),t("h3",{attrs:{id:"联合索引范围查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#联合索引范围查询"}},[a._v("#")]),a._v(" 联合索引范围查询")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("范围查询使用到第几列，则联合索引该列后面的字段的不能使用索引")])]),a._v(" "),t("li",[t("p",[a._v("a > 3 使用了索引 a （长度为 5 ）")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("explain  SELECT * from d001_index WHERE a > 3  ; 使用到了索引\n\n")])])])]),a._v(" "),t("li",[t("p",[a._v("a = 1 and b > 1 ：使用了联合索引 a、b（长度为10）")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("explain SELECT * from d001_index WHERE a = 1 and  b > 1 ;\n\n")])])])]),a._v(" "),t("li",[t("p",[a._v("a = 5 AND b > 6 AND c = 7 ：使用了联合索引 a、b（长度为10）")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("explain SELECT * from d001_index WHERE a = 5 AND b > 6 AND c = 7\n\n")])])])])]),a._v(" "),t("h4",{attrs:{id:"可以用到索引的情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可以用到索引的情况"}},[a._v("#")]),a._v(" 可以用到索引的情况")]),a._v(" "),t("ul",[t("li",[a._v("A>5")]),a._v(" "),t("li",[a._v("A=5 AND B>6")]),a._v(" "),t("li",[a._v("A=5 AND B=6 AND C=7")])]),a._v(" "),t("h4",{attrs:{id:"下面的条件将不能用上组合索引查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下面的条件将不能用上组合索引查询"}},[a._v("#")]),a._v(" 下面的条件将不能用上组合索引查询")]),a._v(" "),t("ul",[t("li",[a._v("B>5 ——查询条件不包含组合索引首列字段")]),a._v(" "),t("li",[a._v("B=6 AND C=7 ——查询条件不包含组合索引首列字段")])]),a._v(" "),t("h4",{attrs:{id:"下面条件将能用上部分组合索引查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下面条件将能用上部分组合索引查询"}},[a._v("#")]),a._v(" 下面条件将能用上部分组合索引查询")]),a._v(" "),t("ul",[t("li",[a._v("A>5 AND B=2 ——当范围查询使用第一列，查询条件仅仅能使用第一列 A")]),a._v(" "),t("li",[a._v("A=5 AND B>6 AND C=2 ——范围查询使用第二列，查询条件仅仅能使用前二列    A ,B")])])])}),[],!1,null,null,null);s.default=r.exports}}]);